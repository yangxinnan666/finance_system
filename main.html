<!DOCTYPE html>
<html>
<head>
    <title>财务与报单管理系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>💰 财务与报单管理系统</h1>
        <div class="user-info">
            身份: <span id="currentRole"></span> | 
            用户: <span id="currentUser"></span> | 
            <a href="index.html" id="logout">退出</a>
        </div>
    </header>

    <nav>
        <button class="nav-btn active" data-page="account">📊 对账系统</button>
        <button class="nav-btn" data-page="report">📦 报单系统</button>
        <button class="nav-btn" data-page="announcement">📢 公告中心</button>
        <button class="nav-btn" data-page="admin" id="adminTab">👑 用户管理</button>
    </nav>

    <main>
        <!-- 对账系统 -->
        <section id="accountPage" class="page active-page">
            <h2>📊 对账记录</h2>
            <form id="accountForm" class="form-grid">
                <input type="text" id="name" placeholder="姓名" required>
                <input type="datetime-local" id="time" required>
                <input type="number" id="amount" placeholder="金额" step="0.01" required>
                <select id="type" required>
                    <option value="">选择类型</option>
                    <option value="income">收入</option>
                    <option value="expense">支出</option>
                </select>
                <select id="payment" required>
                    <option value="">支付方式</option>
                    <option value="alipay">支付宝</option>
                    <option value="wechat">微信</option>
                    <option value="bank">银行卡</option>
                </select>
                <button type="submit">添加记录</button>
            </form>

            <div class="summary-cards">
                <div class="summary-card income">总收入: ¥<span id="totalIncome">0</span></div>
                <div class="summary-card expense">总支出: ¥<span id="totalExpense">0</span></div>
                <div class="summary-card balance">结余: ¥<span id="balance">0</span></div>
            </div>

            <button class="export-btn" onclick="exportAccounts()">📥 导出对账表格</button>

            <div class="table-container">
                <table id="accountTable">
                    <thead><tr><th>姓名</th><th>时间</th><th>金额</th><th>类型</th><th>支付方式</th><th>操作</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- 报单系统 -->
        <section id="reportPage" class="page">
            <h2>📦 报单记录</h2>
            <form id="reportForm" class="form-grid">
                <input type="text" id="reportName" placeholder="姓名" required>
                <input type="text" id="item" placeholder="物品名称" required>
                <input type="text" id="tracking" placeholder="快递单号">
                <input type="datetime-local" id="reportTime" required>
                <select id="status">
                    <option value="待发货">待发货</option>
                    <option value="已发货">已发货</option>
                    <option value="已完成">已完成</option>
                </select>
                <button type="submit">提交报单</button>
            </form>

            <div class="table-container">
                <table id="reportTable">
                    <thead><tr><th>姓名</th><th>物品</th><th>快递单号</th><th>时间</th><th>状态</th><th>操作</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- 公告中心 -->
        <section id="announcementPage" class="page">
            <h2>📢 公告中心</h2>
            <div id="announcementFormContainer" style="display:none;">
                <h3>发布新公告</h3>
                <form id="announcementForm">
                    <input type="text" id="announceTitle" placeholder="公告标题" required>
                    <textarea id="announceContent" placeholder="公告内容..." rows="4" required></textarea>
                    <label><input type="checkbox" id="announcePinned"> 置顶此公告</label>
                    <button type="submit">发布公告</button>
                </form>
                <hr>
            </div>
            <div class="announcement-list">
                <h3>公告列表</h3>
                <div id="announcementsContainer"><p>加载中...</p></div>
            </div>
        </section>

        <!-- 用户管理 -->
        <section id="adminPage" class="page">
            <h2>👑 用户管理</h2>
            <div class="user-controls">
                <input type="text" id="newUsername" placeholder="新用户名">
                <input type="password" id="newPassword" placeholder="密码">
                <select id="newRole">
                    <option value="user">普通用户</option>
                    <option value="admin">管理员</option>
                </select>
                <button onclick="addUser()">添加用户</button>
            </div>
            <div class="table-container">
                <table id="userTable">
                    <thead><tr><th>用户名</th><th>角色</th><th>操作</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="supabase.js"></script>
    <script src="script.js"></script>
</body>
</html>